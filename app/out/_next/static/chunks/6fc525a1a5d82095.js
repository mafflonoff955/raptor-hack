(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,t=>{"use strict";var e=t.i(43476),s=t.i(71645);let i={FixedStep:1/60,MaxDt:.1,PlayerRadius:15,TargetCount:5,TargetRadius:10,TargetBaseScore:100,StressGain:.08,StressRecovery:.2,RepetitionWindowSize:40,BackgroundColor:"#111",PlayerColor:"#fff",TargetColor:"#f00"};class a{step;maxDt;lastTime;accumulator;constructor(t,e){this.step=t,this.maxDt=e,this.lastTime=0,this.accumulator=0}update(t){let e=(t-this.lastTime)/1e3;return this.lastTime=t,e>this.maxDt&&(e=this.maxDt),this.accumulator+=e,e}}class r{x;y;constructor(t,e){this.x=t,this.y=e}static get zero(){return new r(0,0)}add(t){return new r(this.x+t.x,this.y+t.y)}sub(t){return new r(this.x-t.x,this.y-t.y)}mul(t){return new r(this.x*t,this.y*t)}div(t){return new r(this.x/t,this.y/t)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}normalize(){let t=this.mag();return 0===t?r.zero:this.div(t)}dist(t){return this.sub(t).mag()}dot(t){return this.x*t.x+this.y*t.y}clone(){return new r(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}}class l{keys=new Set;constructor(){window.addEventListener("keydown",t=>this.keys.add(t.code)),window.addEventListener("keyup",t=>this.keys.delete(t.code))}getRawDir(){let t=0,e=0;(this.keys.has("ArrowUp")||this.keys.has("KeyW"))&&(e-=1),(this.keys.has("ArrowDown")||this.keys.has("KeyS"))&&(e+=1),(this.keys.has("ArrowLeft")||this.keys.has("KeyA"))&&(t-=1),(this.keys.has("ArrowRight")||this.keys.has("KeyD"))&&(t+=1);let s=new r(t,e);return s.mag()>0?s.normalize():s}}class o{update(t,e,s){let{stress:a}=t;if(s.magSq()>0){let t=s.normalize();a.window.push(t),a.window.length>i.RepetitionWindowSize&&a.window.shift()}let l=0;if(a.window.length>5){let t=r.zero;for(let e of a.window)t=t.add(e);let e=t.normalize();a.window.length>0&&(l=(a.window[a.window.length-1].dot(e)+1)/2)}a.repetition=l;let o=Math.max(0,Math.min(1,(l-.7)/.25)),n=0===s.magSq(),h=n?0:o*i.StressGain*e,c=0;l<.8&&(c+=i.StressRecovery*e),n&&(c+=.5*i.StressRecovery*e),a.value+=h,a.value-=c,a.value<a.baseStress&&(a.value=a.baseStress),a.value>1&&(a.value=1)}}class n{static getFrictionMod(t){return 1-.95*t.stress.value}}class h{stressSystem=new o;update(t,e,s,i,a){if(t.gameOver)return;if(t.t+=e,t.stress.value>=1){t.gameOver=!0;return}let r=s.getRawDir();this.stressSystem.update(t,e,r);let l=n.getFrictionMod(t);r.magSq()>0&&(t.player.vel=t.player.vel.add(r.mul(2e3*e)));let o=.85+(1-l)*.145;t.stress.value>.4&&(o-=.1*(.5*Math.sin(3*t.t)+.5)*(t.stress.value-.4));let h=Math.pow(o,60*e);t.player.vel=t.player.vel.mul(h),t.player.pos=t.player.pos.add(t.player.vel.mul(e)),t.player.pos.x<0&&(t.player.pos.x=0,t.player.vel.x*=-.5),t.player.pos.x>i&&(t.player.pos.x=i,t.player.vel.x*=-.5),t.player.pos.y<0&&(t.player.pos.y=0,t.player.vel.y*=-.5),t.player.pos.y>a&&(t.player.pos.y=a,t.player.vel.y*=-.5),this.updateTargets(t,i,a,e)}updateTargets(t,e,s,a){let l=i.TargetCount;t.targets.length<l&&this.spawnTarget(t,e,s,!1),t.stress.value>.6&&t.targets.filter(t=>t.ghost).length<3&&.05>Math.random()&&this.spawnTarget(t,e,s,!0);let o=t.stress.value;for(let l=t.targets.length-1;l>=0;l--){let n=t.targets[l];if(o>.4){let t=new r((Math.random()-.5)*o*2,(Math.random()-.5)*o*2);n.pos=n.pos.add(t)}if(o>.7){let i=n.pos.sub(t.player.pos);if(150>i.mag()){let t=i.normalize().mul(100*a*o);n.pos=n.pos.add(t),n.pos.x<0&&(n.pos.x=0),n.pos.x>e&&(n.pos.x=e),n.pos.y<0&&(n.pos.y=0),n.pos.y>s&&(n.pos.y=s)}}t.player.pos.dist(n.pos)<i.PlayerRadius+n.radius&&(n.ghost?t.stress.value+=.05:(t.score+=n.value,t.stress.baseStress+=.04,t.stress.baseStress>1&&(t.stress.baseStress=1)),t.targets.splice(l,1))}}spawnTarget(t,e,s,a){let l=t.score+t.targets.length+t.t,o=(.5*Math.sin(.1*l)+.5)*(e-100)+50,n=(.5*Math.cos(1.3*l)+.5)*(s-100)+50;t.targets.push({id:Math.floor(l),pos:new r(o,n),radius:i.TargetRadius,value:i.TargetBaseScore,phase:l,ghost:a})}}class c{draw(t,e,s,a){let r=e.stress.value;r>.8?t.filter="invert(1) hue-rotate(180deg)":t.filter="none";let l=i.BackgroundColor;if(r>.2){let t=(r-.2)/.8;l=`hsl(${240-240*t}, 50%, ${5+10*t}%)`}if(t.fillStyle=l,t.fillRect(0,0,s,a),t.save(),r>.05&&!e.gameOver){let s=20*Math.pow(r,2),i=Math.sin(15*e.t)*s,a=Math.cos(17*e.t)*s;t.translate(i,a)}if(!e.gameOver)if(r>.2){let s=4*r;t.globalCompositeOperation="screen",t.fillStyle="#f00",t.beginPath(),t.arc(e.player.pos.x-s,e.player.pos.y,i.PlayerRadius,0,2*Math.PI),t.fill(),t.fillStyle="#0f0",t.beginPath(),t.arc(e.player.pos.x,e.player.pos.y,i.PlayerRadius,0,2*Math.PI),t.fill(),t.fillStyle="#00f",t.beginPath(),t.arc(e.player.pos.x+s,e.player.pos.y,i.PlayerRadius,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-over"}else t.fillStyle=i.PlayerColor,t.beginPath(),t.arc(e.player.pos.x,e.player.pos.y,i.PlayerRadius,0,2*Math.PI),t.fill();for(let s of e.targets){t.beginPath();let a=s.radius+2*Math.sin(5*e.t+s.phase);s.ghost?(t.strokeStyle="#666",t.lineWidth=2,t.setLineDash([4,4]),t.arc(s.pos.x,s.pos.y,a,0,2*Math.PI),t.stroke(),t.setLineDash([])):(t.fillStyle=i.TargetColor,t.arc(s.pos.x,s.pos.y,a,0,2*Math.PI),t.fill())}t.restore(),this.drawUI(t,e,s,a)}drawUI(t,e,s,i){if(e.gameOver){t.fillStyle="rgba(50, 0, 0, 0.8)",t.fillRect(0,0,s,i),t.fillStyle="#f00",t.font="bold 48px sans-serif",t.textAlign="center",t.fillText("COLLAPSE COMPLETE",s/2,i/2-20),t.fillStyle="#fff",t.font="24px monospace",t.fillText(`Final Score: ${e.score}`,s/2,i/2+30),t.fillText("Press R to Reboot",s/2,i/2+70);return}t.fillStyle="#fff",t.textAlign="left",t.font="20px monospace",t.fillText(`Score: ${e.score}`,20,30);let a=s/2-100;t.strokeStyle="#555",t.strokeRect(a,30,200,10);let r=e.stress.value;t.fillStyle=r>.8?"#f00":r>.4?"#ff0":"#0f0",t.fillRect(a,30,200*r,10),t.font="12px monospace",t.fillStyle="#ccc",t.fillText("SYSTEM INSTABILITY",a,25)}}class u{active=!1;constructor(){window.addEventListener("keydown",t=>{"d"===t.key&&(this.active=!this.active)})}draw(t,e){if(!this.active)return;t.save(),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(10,60,250,150),t.fillStyle="#0f0",t.font="12px monospace";let s=80,i=e=>{t.fillText(e,20,s),s+=15};i("FPS: ?"),i(`Time: ${e.t.toFixed(1)}`),i(`Stress: ${e.stress.value.toFixed(3)}`),i(`Repetition: ${e.stress.repetition.toFixed(3)}`),i(`Targets: ${e.targets.length}`),i(`Player: ${e.player.pos.x.toFixed(0)}, ${e.player.pos.y.toFixed(0)}`),t.strokeStyle="#fff",t.strokeRect(20,s,200,10),t.fillStyle="#f00",t.fillRect(20,s,200*e.stress.value,10),t.restore()}}class d{ctx=null;masterGain=null;oscA=null;oscB=null;filter=null;started=!1;constructor(){{const t=window.AudioContext||window.webkitAudioContext;t&&(this.ctx=new t,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.value=.1,this.filter=this.ctx.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=800,this.filter.connect(this.masterGain))}}async start(){!this.ctx||("suspended"===this.ctx.state&&await this.ctx.resume(),this.started||(this.filter&&(this.oscA=this.ctx.createOscillator(),this.oscA.type="triangle",this.oscA.frequency.value=220,this.oscA.connect(this.filter),this.oscA.start(),this.oscB=this.ctx.createOscillator(),this.oscB.type="sine",this.oscB.frequency.value=110,this.oscB.connect(this.filter),this.oscB.start()),this.started=!0))}update(t){if(!this.ctx||!this.started||!this.oscA||!this.oscB||!this.filter)return;let e=t.stress.value,s=50*Math.pow(e,2)*Math.sin(3*t.t);this.oscA.detune.value=s,this.oscB.detune.value=-s,this.filter.frequency.setTargetAtTime(1200-1e3*e,this.ctx.currentTime,.1)}}class p{static Thresholds=[{value:.35,id:"T1"},{value:.6,id:"T2"},{value:.8,id:"T3"},{value:.92,id:"T4"}];update(t){let e=t.stress.value;for(let s=0;s<p.Thresholds.length;s++)!t.collapse.thresholdsHit[s]&&e>=p.Thresholds[s].value&&(t.collapse.thresholdsHit[s]=!0)}static getLevel(t){return t.collapse.thresholdsHit.filter(t=>t).length}}let y=(t,e)=>({t:0,score:0,gameOver:!1,player:{pos:new r(t/2,e/2),vel:r.zero},targets:[],stress:{value:0,baseStress:0,repetition:0,window:[],lastMoveVec:r.zero},collapse:{thresholdsHit:[!1,!1,!1,!1]}});class f{canvas;ctx;running=!1;time;input;sim;render;debug;audio;collapse;state;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw Error("No 2D context");this.ctx=e,this.time=new a(i.FixedStep,i.MaxDt),this.input=new l,this.sim=new h,this.render=new c,this.debug=new u,this.audio=new d,this.collapse=new p,this.resize(),this.state=y(this.canvas.width,this.canvas.height),window.addEventListener("resize",()=>this.resize()),window.addEventListener("keydown",t=>{this.state.gameOver&&("r"===t.key||"R"===t.key)&&(this.state=y(this.canvas.width,this.canvas.height),this.collapse=new p)});const s=()=>{this.audio.start(),window.removeEventListener("keydown",s),window.removeEventListener("click",s)};window.addEventListener("keydown",s),window.addEventListener("click",s)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.running=!0,this.time.lastTime=performance.now(),requestAnimationFrame(t=>this.loop(t))}stop(){this.running=!1}loop(t){if(this.running){for(requestAnimationFrame(t=>this.loop(t)),this.time.update(t);this.time.accumulator>=i.FixedStep;)this.collapse.update(this.state),this.sim.update(this.state,i.FixedStep,this.input,this.canvas.width,this.canvas.height),this.time.accumulator-=i.FixedStep;this.audio.update(this.state),this.render.draw(this.ctx,this.state,this.canvas.width,this.canvas.height),this.debug.draw(this.ctx,this.state),this.audio.started||(this.ctx.fillStyle="#fff",this.ctx.font="16px monospace",this.ctx.fillText("Press any key to start audio",this.canvas.width/2-100,this.canvas.height-50))}}}function w(){let t=(0,s.useRef)(null),i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!t.current||i.current)return;let e=new f(t.current);return i.current=e,e.start(),()=>{e.stop()}},[]),(0,e.jsx)("main",{className:"w-full h-full overflow-hidden bg-black",children:(0,e.jsx)("canvas",{ref:t,className:"block w-full h-full"})})}t.s(["default",()=>w],31713)}]);